# Enhanced Task Prompt: BUG-010

**Generated**: 2025-01-13
**Sprint**: Sprint 17.1 - Desktop Authentication & Installation Bugs
**Task ID**: BUG-010
**Status**: pending
**Agent**: ui-agent
**Enhanced Prompt**: internal/sprints/enhanced_prompts/BUG-010_ENHANCED_PROMPT.md
**Template**: MVP-003-PromptEnhancer-TaskTemplate-v1.4.3

---

## ‚ö†Ô∏è MANDATORY: Pre-Task Analysis (Pattern-TASK-ANALYSIS-001)

**STOP. Before reading ANY code or writing ANY solution, complete this 8-step analysis OUT LOUD:**

### 8-Step Pre-Task Analysis

1. ‚úÖ **Understand the Problem**
   - What is broken? Need to verify Code Analyzer and Sprint Planner modals work after BUG-001/008/009 fixes
   - What are the symptoms? Fixes implemented but not tested end-to-end
   - What is the actual issue? Verification task - no bugs yet, need to validate fixes work correctly

2. ‚úÖ **Identify Root Cause**
   - Why is this needed? BUG-001 fixed TaskAnalyzer crash, BUG-008/009 added modals, must verify integration
   - What caused this? Standard verification after critical fixes
   - Is this a symptom of a deeper problem? No - this is quality assurance (verification task)

3. ‚úÖ **Define Success Criteria**
   - How do I know when it's fixed?
     - Code Analyzer opens in workspace without config.json ‚úÖ
     - Code Analyzer opens in workspace with config.json ‚úÖ
     - Sprint Planner opens in workspace without config.json ‚úÖ
     - Sprint Planner opens in workspace with config.json ‚úÖ
     - Q&A flow completes successfully in all scenarios ‚úÖ
     - Enhanced prompts generated in all scenarios ‚úÖ
     - No console errors in any scenario ‚úÖ
   - What does "done" look like?
     - Manual test plan executed on all 7 scenarios
     - Test results documented with screenshots
     - Pass/Fail status for each scenario
     - Issues logged if any found

4. ‚úÖ **List Dependencies**
   - What other tasks/files/systems does this affect?
     - BUG-001 (must be complete - TaskAnalyzer safety check)
     - BUG-008 (must be complete - Code Analyzer modal)
     - BUG-009 (must be complete - Sprint Planner modal)
     - VS Code Extension Development Host (testing environment)
   - What needs to be done first? BUG-001, BUG-008, BUG-009 all must be completed
   - What does this unblock? v0.17.2 release readiness, user confidence in core features

5. ‚úÖ **Estimate Complexity**
   - Simple fix (< 1 hour) or complex refactor (> 4 hours)? SIMPLE (1-2 hours - manual testing only)
   - Single file or multi-file change? NO CODE CHANGES (verification/testing only)

6. ‚úÖ **Choose Approach**
   - What's the best way to solve this?
     - Create manual test plan document (VERIFY_MODALS_TEST.md)
     - Set up 2 test workspaces (with/without config.json)
     - Execute 7 test scenarios systematically
     - Document results with screenshots
     - Report any issues found
   - Are there alternative approaches? Why is this one best?
     - Alternative 1: Automated E2E tests (time-consuming, VS Code webview hard to automate)
     - Alternative 2: Skip verification (risky, could ship broken features)
     - **Best**: Manual testing with documented scenarios (fast, thorough, catches UX issues)

7. ‚úÖ **Identify Risks**
   - What could go wrong? What could break?
     - Modals still crash (BUG-001 fix incomplete)
     - Config.json parsing errors (malformed JSON)
     - Race conditions (multiple rapid modal opens)
     - Enhanced prompts empty or incorrect
     - Console errors indicating underlying issues
   - What are the edge cases?
     - Empty config.json file
     - Malformed config.json (invalid JSON)
     - Config.json with missing agents field
     - Multiple modal opens without closing

8. ‚úÖ **Plan Testing**
   - How will I validate this works?
     - 7 test scenarios (2 modals √ó 2 workspace types + edge cases)
     - Screenshots of working modals
     - Console log verification (no errors)
   - What tests need to be written?
     - Manual test plan (VERIFY_MODALS_TEST.md)
     - No automated tests (verification task)

### Code Workflow Announcement (Pattern-CODE-001)

**Before starting Step 1 (Implementation), announce OUT LOUD:**

"I am about to start testing for task BUG-010. I have completed:
‚úÖ Pattern-TASK-ANALYSIS-001 (8-step pre-task analysis - see above)
‚úÖ Ready to proceed with Pattern-GIT-001 (Git status check)
‚úÖ Ready to proceed with Pattern-TESTING-001 (Manual testing protocols)
‚úÖ Ready to proceed with Pattern-TRACKING-001 (TodoWrite tracking)

I am now proceeding with verification testing."

### Edge Case Handling

**Skip this section ONLY if:**
- ‚ùå Typo fix only (comment/variable name) ‚Üí Skip analysis + announcement
- ‚ùå Documentation update (no code change) ‚Üí Skip analysis + announcement

**MUST complete this section if:**
- ‚úÖ Bug fix ‚Üí MUST complete analysis + announcement + write test first
- ‚úÖ New feature ‚Üí MUST complete analysis + announcement + write test first
- ‚úÖ Refactoring ‚Üí MUST complete analysis + announcement + existing tests must pass
- ‚úÖ Experimental code ‚Üí MUST complete analysis + announcement + mark as "spike"
- ‚úÖ Verification task ‚Üí MUST complete analysis + announcement + execute test plan

---

**Full Pattern References**:
- Pattern-TASK-ANALYSIS-001: Complete 8-step protocol in pattern file
- Pattern-CODE-001: Complete workflow including git checks, testing
- Pattern-TESTING-001: Manual testing protocols

**If you skip this section, you WILL break something. This is NOT optional.**

---

## Task Overview

**Name**: Verify code analyzer and sprint planner modals work after TaskAnalyzer fix

**Why**: Verification task: After fixing BUG-001 (TaskAnalyzer undefined agent reference), we need to verify that code analyzer and sprint planner modals work correctly.

Current status: BUG-001 fixed (safety check added), but not yet tested end-to-end.
Expected behavior: Both modals should open, run Q&A flow, and generate enhanced prompts without errors.

Impact: Ensures fix is complete and no regression introduced.
Severity: HIGH - Verification of critical fix.

**Current State**:
- BUG-001: COMPLETED (TaskAnalyzer safety check added)
- BUG-008: COMPLETED (Code Analyzer modal implemented)
- BUG-009: COMPLETED (Sprint Planner modal implemented)
- Status: NOT TESTED END-TO-END

**Required State**:
- All 7 test scenarios pass ‚úÖ
- Modals work with and without config.json ‚úÖ
- No console errors ‚úÖ
- Test results documented ‚úÖ

**Impact**: Validates fixes are production-ready, ready for v0.17.2 release

**Severity**: HIGH - Verification of critical fixes

---

## Context Gathered

### Git Status
- **Branch**: feature/v0.17.2-bug-fixes
- **Status**: Clean (no uncommitted changes)
- **Ready for**: BUG-010 verification testing

### Sprint TOML
- **File**: `internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml`
- **Task Entry**: Lines 2279-2382
- **Management**: Use `/sprint-task-lifecycle` skill (see Pattern-TRACKING-001)

### Related Fixes (Dependencies)

1. **BUG-001: TaskAnalyzer undefined agent reference** (MUST BE COMPLETE)
   - Fix: Added safety check in TaskAnalyzer.detectMissingTestStrategy()
   - Code: `if (!config.agents) { return gaps; }`
   - Prevents crash when config.json missing or agents field undefined

2. **BUG-008: Code Analyzer modal** (MUST BE COMPLETE)
   - Fix: Added Q&A modal with form fields (languages, frameworks, focus, complexity)
   - Commit: adbf0cf
   - Location: voicePanel.ts:4103-4230

3. **BUG-009: Sprint Planner modal** (MUST BE COMPLETE)
   - Fix: Added Q&A modal with form fields (duration, team size, goals, priorities)
   - Commit: [check recent commits]
   - Location: voicePanel.ts:4232-4348

### Test Scenarios

**Scenario 1: Fresh workspace (no config.json)**
- Code Analyzer opens ‚úÖ
- Q&A flow works ‚úÖ
- Enhanced prompt generated ‚úÖ

**Scenario 2: Workspace with config.json**
- Code Analyzer opens ‚úÖ
- Agents config used correctly ‚úÖ
- Enhanced prompt includes agent patterns ‚úÖ

**Scenario 3: Sprint Planner (same as Scenario 1)**

**Scenario 4: Sprint Planner (same as Scenario 2)**

**Scenario 5: Edge case - Empty config.json**

**Scenario 6: Edge case - Malformed config.json**

**Scenario 7: Edge case - Multiple rapid modal opens (race conditions)**

### Patterns Referenced

- **Pattern-TASK-ANALYSIS-001**: 8-step pre-task analysis (MANDATORY)
- **Pattern-CODE-001**: Code workflow + announcement (MANDATORY)
- **Pattern-TRACKING-001**: Task tracking + Sprint TOML lifecycle
- **Pattern-GIT-001**: Git workflow integration
- **Pattern-TESTING-001**: Manual testing protocols
- **Pattern-VALIDATION-001**: Pre-flight checklist enforcement
- **Pattern-COMPLETION-001**: Post-completion documentation

---

## Pre-Flight Checklist

**STOP. Complete Pattern-VALIDATION-001 checklist OUT LOUD:**

‚úÖ Did I verify dependencies complete? (BUG-001, BUG-008, BUG-009 all completed)
‚úÖ Did I set up test environment? (VS Code Extension Development Host ready)
‚úÖ Did I create test workspaces? (with/without config.json)
‚úÖ Did I prepare test plan document? (VERIFY_MODALS_TEST.md ready to create)

**Full Checklist**: Pattern-VALIDATION-001 (4 categories, 15+ questions)

**Automated Validation**: Pre-commit hooks run 8 validators automatically

---

## Implementation Steps (Manual Testing Approach)

**Patterns**: Pattern-TESTING-001 (Manual testing protocols), Pattern-GIT-001 (Git workflow), Pattern-TRACKING-001 (Sprint TOML lifecycle)

**REMINDER**: If you haven't completed Section 0 (Pre-Task Analysis + Code Workflow Announcement), STOP and complete it NOW.

---

### Step 0: Git Status + Sprint TOML Update (2 min)

**Update Sprint Status**:
```bash
/sprint-task-lifecycle start BUG-010
```

**Fallback** (if skill unavailable): Follow Pattern-TRACKING-001 manual process

**Check Git Status**:
```bash
git status
git branch --show-current
```

**Goal**: Status = "in_progress", on feature/v0.17.2-bug-fixes branch, clean working tree

---

### Step 1: Verify Dependencies Complete (5 min)
**Tool**: Read
**Files**: Sprint TOML + Git log

**Goal**: Confirm BUG-001, BUG-008, BUG-009 are all completed

**Actions**:
1. Check sprint TOML for BUG-001 status (should be "completed")
2. Check sprint TOML for BUG-008 status (should be "completed")
3. Check sprint TOML for BUG-009 status (should be "completed")
4. Verify commits exist for all 3 fixes

**Commands**:
```bash
# Check BUG-001 status
grep -A 5 "^\[tasks.BUG-001\]" internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml | grep status

# Check BUG-008 status
grep -A 5 "^\[tasks.BUG-008\]" internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml | grep status

# Check BUG-009 status
grep -A 5 "^\[tasks.BUG-009\]" internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml | grep status

# Check recent commits
git log --oneline -10
```

**Expected Result**: All 3 bugs show status = "completed"

**If NOT complete**: BLOCK - Cannot proceed with verification until all 3 fixes are complete

---

### Step 2: Create Manual Test Plan Document (15 min)
**Tool**: Write
**File**: `vscode-lumina/test/manual/VERIFY_MODALS_TEST.md` (CREATE NEW)

**Goal**: Document 7 test scenarios with pass/fail checkboxes

**Test Plan Template**:

```markdown
# Modal Verification Test Plan (BUG-010)

**Date**: 2025-01-13
**Tester**: [Name]
**VS Code Version**: [e.g., 1.85.0]
**Extension Version**: v0.17.2 (feature/v0.17.2-bug-fixes branch)

---

## Test Environment Setup

### Test Workspace 1: Fresh Workspace (No config.json)

**Setup**:
1. Create new directory: `test-workspace-no-config`
2. Open in VS Code
3. Install √ÜtherLight extension (from source)
4. **DO NOT** create `.aetherlight/config.json`

**Verification**:
- [ ] Directory created
- [ ] Opened in VS Code
- [ ] Extension installed
- [ ] No .aetherlight directory exists

---

### Test Workspace 2: Workspace with config.json

**Setup**:
1. Create new directory: `test-workspace-with-config`
2. Open in VS Code
3. Install √ÜtherLight extension (from source)
4. Create `.aetherlight/config.json` with content:

```json
{
  "agents": {
    "infrastructure-agent": {
      "name": "Infrastructure Agent",
      "focus": "Infrastructure, CI/CD, build systems"
    },
    "ui-agent": {
      "name": "UI Agent",
      "focus": "User interface, React, TypeScript"
    }
  }
}
```

**Verification**:
- [ ] Directory created
- [ ] Opened in VS Code
- [ ] Extension installed
- [ ] .aetherlight/config.json exists with agents

---

## Test Scenarios

### Scenario 1: Code Analyzer - Fresh Workspace (No config.json)

**Steps**:
1. Open Test Workspace 1 (no config.json)
2. Open Voice Panel (click √ÜtherLight icon in sidebar)
3. Click "Code Analyzer" button (left toolbar)
4. Verify modal opens
5. Fill form:
   - Languages: TypeScript, JavaScript
   - Frameworks: React
   - Focus: Architecture Review
   - Complexity: Moderate
6. Click "‚ú® Enhance" button
7. Verify modal closes
8. Verify enhanced prompt appears in main text area
9. Open browser console (F12) ‚Üí Check for errors

**Expected Results**:
- [ ] Modal opens (no crash, no TypeError)
- [ ] Form fields visible and functional
- [ ] Enhance button works
- [ ] Modal closes after enhance
- [ ] Enhanced prompt appears in text area
- [ ] No console errors

**Actual Results**: _______________

**Screenshots**:
- [ ] Modal opened (screenshot attached)
- [ ] Enhanced prompt in text area (screenshot attached)
- [ ] Console log clean (screenshot attached)

**Status**: [ ] PASS / [ ] FAIL

**Issues Found**: _______________

---

### Scenario 2: Code Analyzer - Workspace with config.json

**Steps**:
1. Open Test Workspace 2 (with config.json)
2. Open Voice Panel
3. Click "Code Analyzer" button
4. Fill form (same as Scenario 1)
5. Click "‚ú® Enhance" button
6. Verify enhanced prompt mentions agents or agent patterns

**Expected Results**:
- [ ] Modal opens
- [ ] Q&A flow works
- [ ] Enhanced prompt generated
- [ ] Enhanced prompt includes agent context or patterns
- [ ] No console errors

**Actual Results**: _______________

**Status**: [ ] PASS / [ ] FAIL

**Issues Found**: _______________

---

### Scenario 3: Sprint Planner - Fresh Workspace (No config.json)

**Steps**:
1. Open Test Workspace 1 (no config.json)
2. Open Voice Panel
3. Click "Sprint Planner" button (left toolbar)
4. Verify modal opens
5. Fill form:
   - Duration: 2 Weeks
   - Team Size: 5
   - Goals: "Implement authentication and fix installation UX"
   - Priorities: New Features, Bug Fixes
6. Click "‚ú® Enhance" button
7. Verify modal closes
8. Verify enhanced sprint plan appears in main text area
9. Check console for errors

**Expected Results**:
- [ ] Modal opens (no crash, no TypeError)
- [ ] Form fields visible and functional
- [ ] Enhance button works
- [ ] Modal closes after enhance
- [ ] Enhanced sprint plan appears in text area
- [ ] No console errors

**Actual Results**: _______________

**Status**: [ ] PASS / [ ] FAIL

**Issues Found**: _______________

---

### Scenario 4: Sprint Planner - Workspace with config.json

**Steps**:
1. Open Test Workspace 2 (with config.json)
2. Open Voice Panel
3. Click "Sprint Planner" button
4. Fill form (same as Scenario 3)
5. Click "‚ú® Enhance" button
6. Verify enhanced plan mentions agents or includes agent-specific tasks

**Expected Results**:
- [ ] Modal opens
- [ ] Q&A flow works
- [ ] Enhanced plan generated
- [ ] Enhanced plan includes agent context
- [ ] No console errors

**Actual Results**: _______________

**Status**: [ ] PASS / [ ] FAIL

**Issues Found**: _______________

---

### Scenario 5: Edge Case - Empty config.json

**Steps**:
1. Create new workspace: `test-workspace-empty-config`
2. Create `.aetherlight/config.json` with content: `{}`
3. Open Voice Panel
4. Click "Code Analyzer" button
5. Verify modal opens (should not crash)

**Expected Results**:
- [ ] Modal opens (no crash)
- [ ] No console errors related to missing agents
- [ ] Q&A flow completes

**Actual Results**: _______________

**Status**: [ ] PASS / [ ] FAIL

**Issues Found**: _______________

---

### Scenario 6: Edge Case - Malformed config.json

**Steps**:
1. Create new workspace: `test-workspace-malformed-config`
2. Create `.aetherlight/config.json` with invalid JSON: `{ "agents": { "foo": }`
3. Open Voice Panel
4. Click "Code Analyzer" button
5. Verify modal opens (should handle parse error gracefully)

**Expected Results**:
- [ ] Modal opens (graceful degradation)
- [ ] Error logged to console (but no crash)
- [ ] Q&A flow completes

**Actual Results**: _______________

**Status**: [ ] PASS / [ ] FAIL

**Issues Found**: _______________

---

### Scenario 7: Edge Case - Multiple Rapid Modal Opens

**Steps**:
1. Open Test Workspace 1 (no config.json)
2. Open Voice Panel
3. Click "Code Analyzer" button ‚Üí immediately click again ‚Üí immediately click again
4. Verify no race conditions or duplicate modals

**Expected Results**:
- [ ] Only one modal visible at a time
- [ ] No race conditions
- [ ] No console errors

**Actual Results**: _______________

**Status**: [ ] PASS / [ ] FAIL

**Issues Found**: _______________

---

## Test Summary

**Total Tests**: 7
**Passed**: ___
**Failed**: ___
**Blocked**: ___

**Critical Issues Found**: _______________

**Sign-off**: [ ] Ready for v0.17.2 release

---

## Appendix: Test Environment Details

**VS Code Version**: _______________
**Node Version**: _______________
**Extension Version**: v0.17.2 (branch: feature/v0.17.2-bug-fixes)
**Platform**: Windows/macOS/Linux
**Date Tested**: _______________
```

**Expected Result**: Test plan document created

---

### Step 3: Set Up Test Workspaces (10 min)
**Tool**: Bash

**Goal**: Create 2 test workspaces (with/without config.json)

**Commands**:
```bash
# Create test workspace 1 (no config)
mkdir -p /tmp/test-workspace-no-config
cd /tmp/test-workspace-no-config
echo "# Test Workspace" > README.md

# Create test workspace 2 (with config)
mkdir -p /tmp/test-workspace-with-config
cd /tmp/test-workspace-with-config
mkdir -p .aetherlight
cat > .aetherlight/config.json <<'EOF'
{
  "agents": {
    "infrastructure-agent": {
      "name": "Infrastructure Agent",
      "focus": "Infrastructure, CI/CD, build systems"
    },
    "ui-agent": {
      "name": "UI Agent",
      "focus": "User interface, React, TypeScript"
    }
  }
}
EOF
echo "# Test Workspace" > README.md

# Verify workspaces created
ls -la /tmp/test-workspace-no-config
ls -la /tmp/test-workspace-with-config/.aetherlight
```

**Expected Result**: 2 test workspaces created

---

### Step 4: Execute Test Scenarios (30 min)
**Pattern**: Pattern-TESTING-001 (Manual testing)

**Goal**: Execute all 7 test scenarios systematically

**Instructions**:
1. Launch VS Code Extension Development Host (F5)
2. For each test scenario:
   - Follow steps in test plan
   - Mark checkboxes as you go
   - Take screenshots of key moments
   - Document any issues found
3. Update test plan with actual results

**Test Order**:
1. Scenario 1: Code Analyzer - Fresh Workspace
2. Scenario 2: Code Analyzer - With config.json
3. Scenario 3: Sprint Planner - Fresh Workspace
4. Scenario 4: Sprint Planner - With config.json
5. Scenario 5: Edge Case - Empty config.json
6. Scenario 6: Edge Case - Malformed config.json
7. Scenario 7: Edge Case - Multiple rapid opens

**Expected Result**: All 7 scenarios executed, results documented

---

### Step 5: Document Results + Screenshots (15 min)
**Tool**: Edit

**Goal**: Update test plan with actual results and attach screenshots

**Actions**:
1. Fill in "Actual Results" for each scenario
2. Mark "Status" (PASS/FAIL) for each scenario
3. Take screenshots:
   - Modal opened (each scenario)
   - Enhanced prompt in text area (each scenario)
   - Console log clean (each scenario)
4. Attach screenshots to test plan document
5. Fill in "Test Summary" section

**Expected Result**: Complete test report with screenshots

---

### Step 6: Update Sprint TOML Completion Notes (5 min) - MANDATORY üõë

**‚ö†Ô∏è CRITICAL REQUIREMENT**: This step is MANDATORY. DO NOT proceed to Step 7 (Commit) until this is complete.

**Pattern**: Pattern-COMPLETION-001

**Why This Step Exists**: Historical audits (BUG-002A, BUG-003, BUG-002) found agents skipped completion documentation. This step MUST be completed BEFORE committing changes. If you skip this, your commit will be considered incomplete.

---

**Update Sprint TOML with completion_notes field:**

Open `internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml` and add the following to BUG-010 task section (after `completed_date`):

```toml
[tasks.BUG-010]
status = "completed"
completed_date = "2025-01-13"

completion_notes = """
Completed 2025-01-13 by AI agent (ui-agent)

Verification Testing Results:
- Scenario 1: Code Analyzer (no config.json) - PASS ‚úÖ
- Scenario 2: Code Analyzer (with config.json) - PASS ‚úÖ
- Scenario 3: Sprint Planner (no config.json) - PASS ‚úÖ
- Scenario 4: Sprint Planner (with config.json) - PASS ‚úÖ
- Scenario 5: Edge Case (empty config.json) - PASS ‚úÖ
- Scenario 6: Edge Case (malformed config.json) - PASS ‚úÖ
- Scenario 7: Edge Case (multiple rapid opens) - PASS ‚úÖ

Technical Details:
- Files Created: vscode-lumina/test/manual/VERIFY_MODALS_TEST.md (test plan)
- Lines Added: ~300 lines (test plan document with 7 scenarios)
- Test Coverage: 100% (all 7 scenarios executed and documented)
- Breaking Change: No (verification only)
- Commit: [PENDING - will add after Step 7]

Verification Summary:
1. BUG-001 fix verified: TaskAnalyzer no longer crashes when config.json missing ‚úÖ
2. BUG-008 fix verified: Code Analyzer modal works correctly ‚úÖ
3. BUG-009 fix verified: Sprint Planner modal works correctly ‚úÖ
4. No regressions introduced by fixes ‚úÖ
5. All edge cases handled gracefully ‚úÖ

Test Environment:
- VS Code Version: [VERSION]
- Extension Version: v0.17.2 (feature/v0.17.2-bug-fixes)
- Platform: [Windows/macOS/Linux]
- Test Date: 2025-01-13

Scenarios Tested:
1. Code Analyzer - Fresh Workspace (No config.json):
   - Modal opened successfully
   - Q&A form filled: TypeScript, JavaScript, React, Architecture Review
   - Enhanced prompt generated correctly
   - No console errors
   - Result: PASS ‚úÖ

2. Code Analyzer - Workspace with config.json:
   - Modal opened successfully
   - Agents config detected and used
   - Enhanced prompt includes agent patterns
   - No console errors
   - Result: PASS ‚úÖ

3. Sprint Planner - Fresh Workspace (No config.json):
   - Modal opened successfully
   - Q&A form filled: 2 Weeks, 5 team members, goals, priorities
   - Enhanced sprint plan generated correctly
   - No console errors
   - Result: PASS ‚úÖ

4. Sprint Planner - Workspace with config.json:
   - Modal opened successfully
   - Agents config detected and used
   - Enhanced plan includes agent-specific tasks
   - No console errors
   - Result: PASS ‚úÖ

5. Edge Case - Empty config.json:
   - Modal opened successfully (no crash)
   - Graceful degradation (no agents field)
   - Q&A flow completed
   - No console errors (or only expected warnings)
   - Result: PASS ‚úÖ

6. Edge Case - Malformed config.json:
   - Modal opened successfully (graceful error handling)
   - Parse error logged to console (but no crash)
   - Q&A flow completed
   - Result: PASS ‚úÖ

7. Edge Case - Multiple Rapid Modal Opens:
   - Only one modal visible at a time
   - No race conditions
   - No duplicate modals
   - No console errors
   - Result: PASS ‚úÖ

Issues Found: NONE (all scenarios passed)

Impact:
- Verifies: BUG-001, BUG-008, BUG-009 fixes are production-ready
- Confirms: No regressions introduced
- Validates: Edge cases handled gracefully
- Ready: v0.17.2 release approved (modal features)

Dependencies:
- Blocked by: BUG-001 (completed), BUG-008 (completed), BUG-009 (completed)
- Blocks: v0.17.2 release (if verification fails)

Next Steps:
- [ ] v0.17.2 release (if all verifications pass)
- [ ] Address any issues found (if verification fails)

Pattern Compliance:
- ‚úÖ Pattern-TASK-ANALYSIS-001: 8-step pre-task analysis completed
- ‚úÖ Pattern-CODE-001: Code workflow check announced
- ‚úÖ Pattern-GIT-001: Git status checked before commit
- ‚úÖ Pattern-TESTING-001: Manual testing protocols followed (7 scenarios)
- ‚úÖ Pattern-TRACKING-001: TodoWrite used for progress tracking
- ‚úÖ Pattern-COMPLETION-001: Sprint TOML updated with completion_notes

Commit: test(modals): Verify Code Analyzer and Sprint Planner after fixes (BUG-010)
Commit Hash: [PENDING - will add after commit]
"""
```

---

**Validation (MANDATORY - Run BEFORE proceeding to Step 7):**

```bash
# Check if status is "completed"
grep -A 5 "^\[tasks.BUG-010\]" internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml | grep 'status = "completed"'

# Check if completed_date exists
grep -A 5 "^\[tasks.BUG-010\]" internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml | grep "completed_date"

# Check if completion_notes exists
grep -A 50 "^\[tasks.BUG-010\]" internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml | grep "completion_notes"
```

**Expected Output:**
```
status = "completed"
completed_date = "2025-01-13"
completion_notes = """
```

**‚ùå If ANY command returns empty**: Sprint TOML is NOT updated. Do NOT proceed to Step 7. Fix it NOW.

**‚úÖ If ALL commands return results**: Sprint TOML is updated correctly. Proceed to Step 7.

---

**üõë BLOCKER**: DO NOT proceed to Step 7 (Commit) until ALL validation commands return expected output.

---

### Step 7: Commit Changes (5 min)

**‚ö†Ô∏è PREREQUISITE CHECK**: Did you complete Step 6 (Update Sprint TOML Completion Notes)?

**If NO**: STOP. Go back to Step 6 and complete it NOW.

**If YES**: Verify by running the 3 validation commands from Step 6. All 3 MUST return results.

---

**Pattern**: Pattern-GIT-001 (full commit format + workflow)

```bash
git add vscode-lumina/test/manual/VERIFY_MODALS_TEST.md
git add internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml

# If Sprint TOML modified
node scripts/validate-sprint-schema.js

# Commit (use HEREDOC for proper formatting)
git commit -m "$(cat <<'EOF'
test(modals): Verify Code Analyzer and Sprint Planner after fixes (BUG-010)

- Create manual test plan with 7 verification scenarios
- Execute all scenarios: Code Analyzer + Sprint Planner (with/without config.json)
- Test edge cases: empty config, malformed config, race conditions
- Document results: All 7 scenarios PASS ‚úÖ
- Take screenshots: Modal opened, enhanced prompts, console logs
- Verify no regressions: BUG-001, BUG-008, BUG-009 fixes working correctly

Verification Results:
- Code Analyzer (no config): PASS ‚úÖ
- Code Analyzer (with config): PASS ‚úÖ
- Sprint Planner (no config): PASS ‚úÖ
- Sprint Planner (with config): PASS ‚úÖ
- Edge cases: All PASS ‚úÖ

Ready for v0.17.2 release (modal features verified).

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

**After Commit**: Get commit hash and add it to completion_notes:
```bash
git log -1 --format=%h
# Copy hash and update completion_notes "Commit Hash: {hash}" field
```

---

### Step 8: Update Sprint Status to Completed (2 min)
**Pattern**: Pattern-TRACKING-001

```bash
/sprint-task-lifecycle complete BUG-010
```

**Fallback** (if skill unavailable): Follow Pattern-TRACKING-001 manual process

**Validation**: Verify status = "completed" and completed_date added

---

## Acceptance Criteria

- [ ] Pre-Task Analysis completed (Pattern-TASK-ANALYSIS-001)
- [ ] Code Workflow Announcement made (Pattern-CODE-001)
- [ ] Dependencies verified complete (BUG-001, BUG-008, BUG-009) ‚úÖ
- [ ] Test plan document created (VERIFY_MODALS_TEST.md) ‚úÖ
- [ ] Test workspaces set up (with/without config.json) ‚úÖ
- [ ] Scenario 1 executed (Code Analyzer - no config) ‚úÖ
- [ ] Scenario 2 executed (Code Analyzer - with config) ‚úÖ
- [ ] Scenario 3 executed (Sprint Planner - no config) ‚úÖ
- [ ] Scenario 4 executed (Sprint Planner - with config) ‚úÖ
- [ ] Scenario 5 executed (Edge case - empty config) ‚úÖ
- [ ] Scenario 6 executed (Edge case - malformed config) ‚úÖ
- [ ] Scenario 7 executed (Edge case - multiple opens) ‚úÖ
- [ ] Results documented with screenshots ‚úÖ
- [ ] All scenarios PASS (or issues logged if FAIL) ‚úÖ
- [ ] Sprint TOML completion_notes added (Step 6 - Pattern-COMPLETION-001) üõë MANDATORY
- [ ] Sprint TOML validation commands pass (Step 6 - all 3 commands return results)
- [ ] Sprint TOML updated to "completed" (Pattern-TRACKING-001)
- [ ] Changes committed (Pattern-GIT-001)
- [ ] Ready for v0.17.2 release (if all tests pass)

---

## Error Handling

### Issue 1: Modal still crashes (BUG-001 fix incomplete)
- **Cause**: TaskAnalyzer safety check not working
- **Solution**:
  - Document exact error message and stack trace
  - Create new bug task: BUG-001A with CRITICAL priority
  - Block v0.17.2 release
  - Retest after fix

### Issue 2: Config.json parsing errors
- **Cause**: Malformed JSON not handled gracefully
- **Solution**:
  - Add try/catch around JSON.parse
  - Log error to console (warning level)
  - Gracefully degrade (continue without config)

### Issue 3: Race conditions with multiple modal opens
- **Cause**: No mutex/lock on modal state
- **Solution**:
  - Add check: if (activeWorkflow) return;
  - Prevent multiple simultaneous modals
  - Document in voicePanel.ts

### Issue 4: Enhanced prompt empty or incorrect
- **Cause**: TaskAnalyzer or TaskPromptExporter issue
- **Solution**:
  - Check console logs for errors
  - Verify form data sent correctly in postMessage
  - Check message handler in extension.ts
  - Create bug task if issue found

### Issue 5: Console errors indicate underlying issues
- **Cause**: Various (depends on error)
- **Solution**:
  - Document exact error message
  - Determine if blocker for release
  - Create bug task with appropriate priority
  - Retest after fix

---

## Rollback Plan

**If verification fails (critical issues found)**:
```bash
# Do NOT commit test results
git checkout -- vscode-lumina/test/manual/VERIFY_MODALS_TEST.md
git checkout -- internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml

# Create bug tasks for issues found
# Block v0.17.2 release
# Fix issues, retest
```

**If minor issues found (not blockers)**:
```bash
# Commit test results
# Create bug tasks for future sprints
# Proceed with v0.17.2 release
```

**Emergency Rollback** (catastrophic failure):
```bash
# Revert BUG-001, BUG-008, BUG-009 commits
git revert <commit-hash-bug-009>
git revert <commit-hash-bug-008>
git revert <commit-hash-bug-001>
```

---

## Time Estimate

- Pre-Task Analysis (Pattern-TASK-ANALYSIS-001): 5 min
- Step 0 (Git + Sprint): 2 min
- Step 1 (Verify Dependencies): 5 min
- Step 2 (Create Test Plan): 15 min
- Step 3 (Set Up Workspaces): 10 min
- Step 4 (Execute 7 Scenarios): 30 min
- Step 5 (Document Results): 15 min
- Step 6 (Sprint TOML Completion Notes): 5 min üõë MANDATORY
- Step 7 (Commit): 5 min
- Step 8 (Sprint Complete): 2 min

**Total**: 1.5 hours (within estimated 1-2 hours)

---

## Dependencies

**Blocks**: v0.17.2 release (if verification fails)

**Blocked By**: BUG-001 (must be completed), BUG-008 (must be completed), BUG-009 (must be completed)

---

## Success Impact

After BUG-010 complete:

‚úÖ Code Analyzer modal verified working (with and without config.json)
‚úÖ Sprint Planner modal verified working (with and without config.json)
‚úÖ No regressions introduced by BUG-001/008/009 fixes
‚úÖ Edge cases handled gracefully (empty/malformed config, race conditions)
‚úÖ User confidence restored in core features
‚úÖ Ready for v0.17.2 release (modal features production-ready)
‚úÖ Test plan documented for future regression testing

---

## Notes

**Verification Task Nature**:
- This is a QA/verification task, not a bug fix
- No code changes expected (only test plan document)
- Focus on systematic testing with documented results
- Critical for release readiness

**Manual Testing Rationale**:
- VS Code webview E2E tests are complex to automate
- Manual testing catches UX issues automated tests miss
- Faster to execute than writing E2E automation
- Screenshots provide visual proof of working features

**What to Test**:
1. **Modals open** (no crash, no TypeError)
2. **Q&A flow works** (form submission, validation)
3. **Enhanced prompts generated** (correct content)
4. **Config.json handling** (with/without/empty/malformed)
5. **Console logs clean** (no errors or warnings)
6. **Edge cases** (race conditions, rapid opens)

**If Issues Found**:
- Document exact reproduction steps
- Take screenshots of errors
- Check console logs
- Determine severity (blocker vs minor)
- Create bug tasks with priority
- Retest after fixes

---

**This enhanced prompt follows template v1.4.3 (breadcrumb-based with mandatory pre-task analysis + completion notes in workflow). All universal protocols are in patterns/skills for token efficiency.**

**Pattern References**:
- Pattern-TASK-ANALYSIS-001: 8-step pre-task analysis (MANDATORY)
- Pattern-CODE-001: Code workflow + announcement (MANDATORY)
- Pattern-COMPLETION-001: Post-completion documentation (MANDATORY - Step 6)
- Pattern-TRACKING-001: Sprint TOML lifecycle
- Pattern-GIT-001: Git workflow + commit format
- Pattern-TESTING-001: Manual testing protocols
- Pattern-VALIDATION-001: Pre-flight checklist

**Skill References**:
- sprint-task-lifecycle: Automated Sprint TOML updates

**Token Savings**: ~2,400 tokens (54%+ reduction from v1.0, maintains enforcement)

---

**IMPORTANT**: Completion notes documentation (formerly Section 12) is now **Step 6** in the implementation workflow. This ensures agents complete documentation BEFORE committing changes, not after. See Step 6 for full instructions.
