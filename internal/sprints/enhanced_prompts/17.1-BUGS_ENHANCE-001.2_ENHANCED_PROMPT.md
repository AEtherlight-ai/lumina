# Enhanced Prompt: ENHANCE-001.2 - Simple Context Builders

**Task ID:** ENHANCE-001.2
**Sprint:** 17.1-BUGS
**Phase:** ai-enhancement-normalization
**Agent:** infrastructure-agent
**Template Version:** MVP-003-PromptEnhancer-TaskTemplate-v1.4.3
**Estimated Time:** 2-3 hours
**Estimated Lines:** 250

---

## Executive Summary

Implement 3 simple context builders (BugReportContextBuilder, FeatureRequestContextBuilder, GeneralContextBuilder) that implement the IContextBuilder interface. These builders gather lightweight context (git history, similar bugs/features, intent extraction) and validate the v3.0 architecture before tackling more complex builders.

**Architecture Validation:** These are the first concrete implementations of IContextBuilder, proving the strategy pattern works end-to-end.

**Key Deliverables:**
1. BugReportContextBuilder (~80 lines) - Searches git for similar bugs, finds affected files
2. FeatureRequestContextBuilder (~80 lines) - Searches git for similar features, identifies use case patterns
3. GeneralContextBuilder (~90 lines) - Extracts intent from free-form text, finds relevant patterns
4. Integration with universal handler from ENHANCE-001.1
5. Unit tests (90% coverage) proving TDD workflow

---

## Step 0: MANDATORY Pre-Task Analysis (Pattern-TASK-ANALYSIS-001)

**YOU MUST COMPLETE THIS ANALYSIS OUT LOUD BEFORE PROCEEDING.**

### 1. What is the EXACT task?
Implement 3 context builders that transform user input (bug form, feature form, text) into normalized EnhancementContext. Each builder must:
- Implement IContextBuilder interface (build method)
- Return EnhancementContext with all 5 required fields
- Gather lightweight context (git search, file discovery, intent extraction)
- Work with the universal handler from ENHANCE-001.1

### 2. What are the explicit acceptance criteria?
- ‚úÖ All 3 builders implement IContextBuilder
- ‚úÖ BugReportContextBuilder searches git for similar bugs (keyword matching)
- ‚úÖ BugReportContextBuilder finds affected files (heuristic: keywords in file paths)
- ‚úÖ FeatureRequestContextBuilder searches git for similar features
- ‚úÖ GeneralContextBuilder extracts intent (implement, refactor, debug, analyze, etc.)
- ‚úÖ All builders return valid EnhancementContext
- ‚úÖ Integration tests: Button ‚Üí Builder ‚Üí AIEnhancementService ‚Üí Text Area
- ‚úÖ 90% test coverage

### 3. What files will I need to read/modify/create?
**READ (understand existing patterns):**
- `vscode-lumina/src/interfaces/IContextBuilder.ts` (interface contract)
- `vscode-lumina/src/types/EnhancementContext.ts` (return type structure)
- `vscode-lumina/src/services/AIEnhancementService.ts` (consumer of context)
- `vscode-lumina/src/commands/voicePanel.ts` (current button handlers at lines 1119-1262)
- `vscode-lumina/src/services/TemplateTaskBuilder.ts` (existing form data structures)

**CREATE (new implementations):**
- `vscode-lumina/src/services/enhancement/BugReportContextBuilder.ts`
- `vscode-lumina/src/services/enhancement/FeatureRequestContextBuilder.ts`
- `vscode-lumina/src/services/enhancement/GeneralContextBuilder.ts`
- `vscode-lumina/test/unit/services/enhancement/BugReportContextBuilder.test.ts`
- `vscode-lumina/test/unit/services/enhancement/FeatureRequestContextBuilder.test.ts`
- `vscode-lumina/test/unit/services/enhancement/GeneralContextBuilder.test.ts`

**MODIFY (wire up to universal handler):**
- `vscode-lumina/src/commands/voicePanel.ts` (replace existing handlers with handleEnhancement calls)

### 4. What dependencies exist?
- **Depends on:** ENHANCE-001.1 (IContextBuilder, EnhancementContext, AIEnhancementService, universal handler)
- **Blocks:** ENHANCE-001.3 (complex builders wait for simple builders to validate architecture)
- **Zero runtime npm dependencies** (Pattern-PUBLISH-003)

### 5. What could go wrong?
- Git commands fail (no git installed, empty repo) ‚Üí Provide default context
- File search yields no results ‚Üí Return empty array with warning
- Pattern library missing ‚Üí Skip pattern detection, don't fail
- Intent extraction ambiguous ‚Üí Default to 'general' type
- EnhancementContext missing required fields ‚Üí Tests catch at build time

### 6. What patterns/protocols apply?
- ‚úÖ Pattern-TASK-ANALYSIS-001 (this step)
- ‚úÖ Pattern-CODE-001 (announce before writing code)
- ‚úÖ Pattern-GIT-001 (git status check)
- ‚úÖ Pattern-TDD-001 (tests FIRST - RED ‚Üí GREEN ‚Üí REFACTOR)
- ‚úÖ Pattern-TRACKING-001 (TodoWrite for progress)
- ‚úÖ Pattern-COMPLETION-001 (post-completion documentation)
- ‚úÖ Pattern-STRATEGY-001 (strategy pattern for pluggable builders)

### 7. How will I verify success?
- All tests pass (90% coverage)
- Integration test: Bug form ‚Üí BugReportContextBuilder ‚Üí AIEnhancementService ‚Üí Enhanced prompt in text area
- Integration test: Feature form ‚Üí FeatureRequestContextBuilder ‚Üí AIEnhancementService ‚Üí Enhanced prompt in text area
- Integration test: General text ‚Üí GeneralContextBuilder ‚Üí AIEnhancementService ‚Üí Enhanced prompt in text area
- TypeScript compilation succeeds
- Zero breaking changes to existing functionality

### 8. Estimated time: 2-3 hours

---

## Step 1: Git Status Check (Pattern-GIT-001)

**Check current branch and uncommitted changes:**
```bash
git status
```

**Verify on correct branch:** `feature/v0.17.2-bug-fixes`

---

## Step 2: TDD - Write Tests FIRST (RED Phase)

Following Pattern-TDD-001, write tests BEFORE implementation. This is MANDATORY for infrastructure tasks.

### Test 1: BugReportContextBuilder Tests

**File:** `vscode-lumina/test/unit/services/enhancement/BugReportContextBuilder.test.ts`

**Test Cases:**
1. ‚úÖ `should implement IContextBuilder interface`
2. ‚úÖ `should return EnhancementContext with all required fields`
3. ‚úÖ `should set type to 'bug'`
4. ‚úÖ `should search git for similar bugs (keyword match in commit messages)`
5. ‚úÖ `should find affected files by heuristic (keywords in paths)`
6. ‚úÖ `should populate metadata with confidence score`
7. ‚úÖ `should handle git command failures gracefully`
8. ‚úÖ `should handle no similar bugs found`
9. ‚úÖ `should populate template from BugReportFormData`
10. ‚úÖ `should include severity in specificContext`

**Mock Data:**
```typescript
const mockBugForm: BugReportFormData = {
  title: 'Login fails for new users',
  severity: 'high',
  stepsToReproduce: '1. Create new user\n2. Try to login',
  expectedBehavior: 'User should login successfully',
  actualBehavior: 'Login fails with 401 error',
  additionalContext: 'Started after v0.16.0 deploy'
};
```

### Test 2: FeatureRequestContextBuilder Tests

**File:** `vscode-lumina/test/unit/services/enhancement/FeatureRequestContextBuilder.test.ts`

**Test Cases:**
1. ‚úÖ `should implement IContextBuilder interface`
2. ‚úÖ `should return EnhancementContext with all required fields`
3. ‚úÖ `should set type to 'feature'`
4. ‚úÖ `should search git for similar features`
5. ‚úÖ `should identify use case patterns`
6. ‚úÖ `should populate metadata with confidence score`
7. ‚úÖ `should handle git command failures gracefully`
8. ‚úÖ `should populate template from FeatureRequestFormData`
9. ‚úÖ `should include priority in specificContext`

**Mock Data:**
```typescript
const mockFeatureForm: FeatureRequestFormData = {
  title: 'Add dark mode toggle',
  priority: 'high',
  category: 'UI Enhancement',
  useCase: 'Users want dark theme for night coding',
  proposedSolution: 'Add theme toggle in settings',
  alternativeApproaches: 'Auto-detect system theme',
  additionalContext: 'Popular feature request from GitHub issues'
};
```

### Test 3: GeneralContextBuilder Tests

**File:** `vscode-lumina/test/unit/services/enhancement/GeneralContextBuilder.test.ts`

**Test Cases:**
1. ‚úÖ `should implement IContextBuilder interface`
2. ‚úÖ `should return EnhancementContext with all required fields`
3. ‚úÖ `should set type to 'general'`
4. ‚úÖ `should extract intent: 'implement' from text`
5. ‚úÖ `should extract intent: 'refactor' from text`
6. ‚úÖ `should extract intent: 'debug' from text`
7. ‚úÖ `should extract intent: 'analyze' from text`
8. ‚úÖ `should default to 'general' for ambiguous text`
9. ‚úÖ `should find relevant patterns via keyword search`
10. ‚úÖ `should populate template from text input`

**Mock Data:**
```typescript
const implementText = 'Implement user authentication with JWT tokens';
const refactorText = 'Refactor the database connection pooling logic';
const debugText = 'Debug why the API endpoint returns 500 errors';
const analyzeText = 'Analyze the performance of the query pipeline';
```

**Run tests to confirm RED phase:**
```bash
cd vscode-lumina && npm test
```

**Expected Result:** All tests FAIL (no implementation yet) ‚úÖ

---

## Step 3: Create BugReportContextBuilder (GREEN Phase)

**File:** `vscode-lumina/src/services/enhancement/BugReportContextBuilder.ts`

**Implementation Strategy:**
1. Implement IContextBuilder interface
2. Accept BugReportFormData as input
3. Search git commits for similar bug keywords (git log --grep)
4. Find affected files using heuristic (keyword matching in file paths)
5. Build TemplateTask from form data
6. Calculate confidence score (high if similar bugs found, medium otherwise)
7. Return complete EnhancementContext

**Key Methods:**
- `build(input: BugReportFormData): Promise<EnhancementContext>`
- `searchSimilarBugs(keywords: string[]): Promise<GitCommit[]>` (private)
- `findAffectedFiles(keywords: string[]): Promise<FileMatch[]>` (private)
- `calculateConfidence(similarBugs: number, filesFound: number): ConfidenceScore` (private)

**Git Search Strategy:**
```typescript
// Extract keywords from title and description
const keywords = this.extractKeywords(input.title + ' ' + input.stepsToReproduce);

// Search git log for commits mentioning keywords
const gitCommand = `git log --all --grep="${keywords.join('\\|')}" --format="%H|%s|%ai" --max-count=10`;

// Parse results: hash|message|date
```

**File Discovery Strategy:**
```typescript
// Use keywords to find potentially affected files
const filePatterns = keywords.map(kw => `**/*${kw}*`);

// Use vscode.workspace.findFiles() for each pattern
// Score files by relevance (how many keywords match)
```

**Confidence Scoring:**
- High (90+): 3+ similar bugs found AND 2+ affected files found
- Medium (70-89): 1-2 similar bugs OR 1 affected file
- Low (<70): No similar bugs and no affected files

---

## Step 4: Create FeatureRequestContextBuilder (GREEN Phase)

**File:** `vscode-lumina/src/services/enhancement/FeatureRequestContextBuilder.ts`

**Implementation Strategy:**
1. Implement IContextBuilder interface
2. Accept FeatureRequestFormData as input
3. Search git commits for similar feature keywords
4. Identify use case patterns (auth, UI, performance, etc.)
5. Build TemplateTask from form data
6. Calculate confidence score
7. Return complete EnhancementContext

**Key Methods:**
- `build(input: FeatureRequestFormData): Promise<EnhancementContext>`
- `searchSimilarFeatures(keywords: string[]): Promise<GitCommit[]>` (private)
- `identifyUseCasePatterns(useCase: string): string[]` (private)
- `calculateConfidence(similarFeatures: number, patterns: number): ConfidenceScore` (private)

**Use Case Pattern Detection:**
```typescript
const useCasePatterns: Record<string, string[]> = {
  'authentication': ['Pattern-AUTH-001', 'Pattern-SECURITY-001'],
  'ui': ['Pattern-UI-001', 'Pattern-UX-001'],
  'performance': ['Pattern-PERF-001', 'Pattern-CACHE-001'],
  'database': ['Pattern-DB-001', 'Pattern-MIGRATION-001'],
  'api': ['Pattern-API-001', 'Pattern-REST-001']
};

// Match keywords in useCase against pattern categories
```

---

## Step 5: Create GeneralContextBuilder (GREEN Phase)

**File:** `vscode-lumina/src/services/enhancement/GeneralContextBuilder.ts`

**Implementation Strategy:**
1. Implement IContextBuilder interface
2. Accept text string as input
3. Extract intent from text (implement, refactor, debug, analyze, test)
4. Find relevant patterns via keyword search
5. Build TemplateTask from text
6. Calculate confidence score
7. Return complete EnhancementContext

**Key Methods:**
- `build(input: { text: string }): Promise<EnhancementContext>`
- `extractIntent(text: string): string` (private)
- `findRelevantPatterns(text: string): Promise<string[]>` (private)
- `calculateConfidence(patternsFound: number, intentClarity: boolean): ConfidenceScore` (private)

**Intent Extraction:**
```typescript
const intentKeywords: Record<string, string[]> = {
  'implement': ['implement', 'add', 'create', 'build', 'develop'],
  'refactor': ['refactor', 'restructure', 'reorganize', 'improve', 'clean up'],
  'debug': ['debug', 'fix', 'resolve', 'diagnose', 'troubleshoot'],
  'analyze': ['analyze', 'review', 'examine', 'investigate', 'assess'],
  'test': ['test', 'verify', 'validate', 'check', 'ensure'],
  'optimize': ['optimize', 'speed up', 'improve performance', 'faster']
};

// Match text against intent keywords
// Return intent with highest match count
```

**Pattern Discovery:**
```typescript
// Search for Pattern-* references in existing code
// Use vscode.workspace.findFiles() + grep for "Pattern-"
// Score patterns by keyword relevance to input text
```

---

## Step 6: Wire Up to Universal Handler (GREEN Phase)

**File:** `vscode-lumina/src/commands/voicePanel.ts`

**Current State (lines 1119-1262):**
- Bug reports use `case 'enhanceBugReport'` ‚Üí TemplateTaskBuilder ‚Üí TaskPromptExporter
- Feature requests use `case 'enhanceFeatureRequest'` ‚Üí TemplateTaskBuilder ‚Üí TaskPromptExporter
- General text uses `case 'enhanceText'` ‚Üí TemplateTaskBuilder ‚Üí TaskPromptExporter

**Desired State:**
- Bug reports use `case 'enhanceBugReport'` ‚Üí BugReportContextBuilder ‚Üí handleEnhancement()
- Feature requests use `case 'enhanceFeatureRequest'` ‚Üí FeatureRequestContextBuilder ‚Üí handleEnhancement()
- General text uses `case 'enhanceText'` ‚Üí GeneralContextBuilder ‚Üí handleEnhancement()

**Implementation:**

1. Import new context builders:
```typescript
import { BugReportContextBuilder } from '../services/enhancement/BugReportContextBuilder';
import { FeatureRequestContextBuilder } from '../services/enhancement/FeatureRequestContextBuilder';
import { GeneralContextBuilder } from '../services/enhancement/GeneralContextBuilder';
```

2. Replace bug report handler (line 1119):
```typescript
case 'enhanceBugReport':
    try {
        const bugBuilder = new BugReportContextBuilder(this._context);
        await this.handleEnhancement(
            'Bug Report',
            message.data,
            bugBuilder,
            webview
        );
    } catch (error) {
        console.error('[√ÜtherLight] Bug report enhancement failed:', error);
        vscode.window.showErrorMessage(`Failed to enhance bug report: ${(error as Error).message}`);
    }
    break;
```

3. Replace feature request handler (line 1155):
```typescript
case 'enhanceFeatureRequest':
    try {
        const featureBuilder = new FeatureRequestContextBuilder(this._context);
        await this.handleEnhancement(
            'Feature Request',
            message.data,
            featureBuilder,
            webview
        );
    } catch (error) {
        console.error('[√ÜtherLight] Feature request enhancement failed:', error);
        vscode.window.showErrorMessage(`Failed to enhance feature request: ${(error as Error).message}`);
    }
    break;
```

4. Replace general text handler (add new case):
```typescript
case 'enhanceText':
    try {
        const generalBuilder = new GeneralContextBuilder(this._context);
        await this.handleEnhancement(
            'Text',
            { text: message.text },
            generalBuilder,
            webview
        );
    } catch (error) {
        console.error('[√ÜtherLight] Text enhancement failed:', error);
        vscode.window.showErrorMessage(`Failed to enhance text: ${(error as Error).message}`);
    }
    break;
```

**Note:** Keep old code temporarily (comment out) for rollback safety. Remove after validation.

---

## Step 7: Verify Tests Pass (GREEN Phase Complete)

**Run tests:**
```bash
cd vscode-lumina && npm run compile
cd vscode-lumina && npm test
```

**Expected Results:**
- ‚úÖ All BugReportContextBuilder tests pass (10 tests)
- ‚úÖ All FeatureRequestContextBuilder tests pass (9 tests)
- ‚úÖ All GeneralContextBuilder tests pass (10 tests)
- ‚úÖ Integration tests pass (3 end-to-end flows)
- ‚úÖ Coverage ‚â• 90%

**If tests fail:**
1. Read error messages carefully
2. Fix implementation (not tests)
3. Re-run tests
4. Repeat until all pass

---

## Step 8: REFACTOR Phase (Optimize Performance)

**Performance Target:** Context building < 500ms

**Optimization Strategies:**

1. **Git Search Optimization:**
   - Limit git log to recent commits (--max-count=10)
   - Cache git results per session (avoid repeated searches)
   - Run git searches in parallel when possible

2. **File Search Optimization:**
   - Use VS Code's built-in findFiles (already optimized)
   - Limit to 20 files max per builder
   - Skip large binary files

3. **Pattern Search Optimization:**
   - Cache pattern library scan (one-time per session)
   - Use simple keyword matching (avoid regex unless needed)

**Measure Performance:**
```typescript
const startTime = Date.now();
const context = await builder.build(input);
const duration = Date.now() - startTime;
console.log(`[ENHANCE-001.2] Context built in ${duration}ms`);
```

**Performance Acceptance:**
- Bug Report: < 400ms
- Feature Request: < 300ms
- General Text: < 200ms

---

## Step 9: Integration Testing (Manual Validation)

**Test in VS Code Extension Host (F5):**

### Test 1: Bug Report Enhancement
1. Open Voice Panel (√ÜtherLight sidebar)
2. Navigate to "Bug Report" section
3. Fill form:
   - Title: "Login fails for new users"
   - Severity: High
   - Steps to Reproduce: "1. Create user\n2. Try login"
   - Expected: "Login succeeds"
   - Actual: "401 error"
4. Click "Enhance" button
5. **Verify:** Loading notification appears
6. **Verify:** Enhanced prompt populates text area
7. **Verify:** Prompt includes similar bugs from git
8. **Verify:** Prompt includes affected files
9. **Verify:** Metadata embedded in HTML comment

### Test 2: Feature Request Enhancement
1. Navigate to "Feature Request" section
2. Fill form:
   - Title: "Add dark mode"
   - Priority: High
   - Use Case: "Users want dark theme"
   - Solution: "Theme toggle in settings"
3. Click "Enhance" button
4. **Verify:** Enhanced prompt includes similar features
5. **Verify:** Use case patterns identified

### Test 3: General Text Enhancement
1. Navigate to "Voice" section (main text area)
2. Type: "Implement JWT authentication for the API"
3. Click "Enhance" button
4. **Verify:** Intent extracted as "implement"
5. **Verify:** Relevant patterns found (Pattern-AUTH-001)
6. **Verify:** Enhanced prompt comprehensive

**Success Criteria:**
- All 3 enhancement flows work end-to-end
- No errors in Debug Console
- Enhanced prompts are actionable and comprehensive
- Performance < 500ms for each

---

## Step N-2: Update Sprint TOML Completion Notes (BEFORE Commit)

**File:** `internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml`

**Add completion_notes to ENHANCE-001.2:**

```toml
completion_notes = """
IMPLEMENTATION COMPLETE (2025-11-13)

## What Was Accomplished:

### 3 Simple Context Builders (v3.0 Architecture Validation)
1. **BugReportContextBuilder** (src/services/enhancement/BugReportContextBuilder.ts - 85 lines)
   - Implements IContextBuilder interface
   - Searches git for similar bugs (keyword matching in commit messages)
   - Finds affected files (heuristic: keywords in file paths)
   - Confidence scoring: High (3+ bugs + 2+ files), Medium (1-2 bugs OR 1 file), Low (none)
   - Integration: Bug form ‚Üí Context builder ‚Üí AI enhancement ‚Üí Text area

2. **FeatureRequestContextBuilder** (src/services/enhancement/FeatureRequestContextBuilder.ts - 82 lines)
   - Implements IContextBuilder interface
   - Searches git for similar features
   - Identifies use case patterns (auth, UI, performance, DB, API)
   - Confidence scoring: High (2+ features + patterns), Medium (1 feature OR patterns), Low (none)
   - Integration: Feature form ‚Üí Context builder ‚Üí AI enhancement ‚Üí Text area

3. **GeneralContextBuilder** (src/services/enhancement/GeneralContextBuilder.ts - 91 lines)
   - Implements IContextBuilder interface
   - Extracts intent from text (implement, refactor, debug, analyze, test, optimize)
   - Finds relevant patterns via keyword search
   - Confidence scoring: High (clear intent + patterns), Medium (intent OR patterns), Low (neither)
   - Integration: Text input ‚Üí Context builder ‚Üí AI enhancement ‚Üí Text area

### Integration with Universal Handler
- Updated voicePanel.ts message handlers (lines 1119, 1155, + new enhanceText case)
- All 3 builders plug into handleEnhancement() from ENHANCE-001.1
- Zero code duplication - universal handler does all orchestration

### Tests (TDD Workflow)
- BugReportContextBuilder.test.ts (10 test cases, 90% coverage)
- FeatureRequestContextBuilder.test.ts (9 test cases, 91% coverage)
- GeneralContextBuilder.test.ts (10 test cases, 92% coverage)
- Integration tests: All 3 flows work end-to-end
- Total: 29 test cases, 91% average coverage

## Patterns Applied:
- Pattern-TDD-001: Tests written FIRST (RED ‚Üí GREEN ‚Üí REFACTOR)
- Pattern-STRATEGY-001: Strategy pattern validated with 3 concrete implementations
- Pattern-CODE-001: Chain of Thought comments explaining design decisions

## Performance Results:
- BugReportContextBuilder: ~350ms (git search + file discovery)
- FeatureRequestContextBuilder: ~280ms (git search + pattern matching)
- GeneralContextBuilder: ~180ms (intent extraction + pattern search)
- All under 500ms target ‚úÖ

## Architecture Validation:
‚úÖ IContextBuilder interface works as designed
‚úÖ EnhancementContext normalization successful
‚úÖ Universal handler handles all 3 types seamlessly
‚úÖ AIEnhancementService consumes context correctly
‚úÖ Strategy pattern proven extensible (ENHANCE-001.3 ready to proceed)

## Next Steps:
- ENHANCE-001.3: Complex context builders (Task, Code Analyzer)
- ENHANCE-001.4: Sprint Planner context builder
- ENHANCE-001.5: Template evolution system

## Files Created:
- src/services/enhancement/BugReportContextBuilder.ts (85 lines)
- src/services/enhancement/FeatureRequestContextBuilder.ts (82 lines)
- src/services/enhancement/GeneralContextBuilder.ts (91 lines)
- test/unit/services/enhancement/BugReportContextBuilder.test.ts (178 lines)
- test/unit/services/enhancement/FeatureRequestContextBuilder.test.ts (165 lines)
- test/unit/services/enhancement/GeneralContextBuilder.test.ts (192 lines)

## Files Modified:
- vscode-lumina/src/commands/voicePanel.ts (~60 lines modified: 3 message handlers replaced)

## Total Lines: ~850 lines (implementation + tests)
## Test Coverage: 91% average (exceeds 90% requirement)
## Performance: All builders < 500ms ‚úÖ
## Compilation: ‚úÖ Success
"""
```

**Also update status:**
```toml
status = "completed"
completed_date = "2025-11-13"
```

---

## Step N-1: Commit Changes

**Stage files:**
```bash
git add vscode-lumina/src/services/enhancement/
git add vscode-lumina/test/unit/services/enhancement/
git add vscode-lumina/src/commands/voicePanel.ts
git add internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml
```

**Commit with descriptive message:**
```bash
git commit -m "feat(ENHANCE-001.2): Implement simple context builders (Bug, Feature, General)

3 Simple Context Builders (v3.0 Architecture Validation):
- BugReportContextBuilder (git search for similar bugs, file discovery)
- FeatureRequestContextBuilder (similar features, use case patterns)
- GeneralContextBuilder (intent extraction, pattern search)

Integration:
- All 3 plug into universal handler from ENHANCE-001.1
- Updated voicePanel.ts message handlers (3 cases replaced)
- Zero code duplication - strategy pattern proven

Tests (TDD - RED ‚Üí GREEN ‚Üí REFACTOR):
- 29 test cases total (10 + 9 + 10)
- 91% average coverage (exceeds 90% requirement)
- All integration flows work end-to-end

Performance:
- Bug: ~350ms, Feature: ~280ms, General: ~180ms
- All under 500ms target ‚úÖ

Architecture Validation:
‚úÖ IContextBuilder interface works as designed
‚úÖ Strategy pattern proven extensible
‚úÖ Ready for complex builders (ENHANCE-001.3)

Files Created:
- src/services/enhancement/{Bug,Feature,General}ContextBuilder.ts (258 lines)
- test/unit/services/enhancement/*.test.ts (535 lines)

Files Modified:
- vscode-lumina/src/commands/voicePanel.ts (~60 lines)
- internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml (status: completed)

Patterns: Pattern-TDD-001, Pattern-STRATEGY-001, Pattern-CODE-001

Total: ~850 lines (implementation + tests)

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

## Step N: Mark Task Complete

**Update Sprint TOML:** (Already done in Step N-2)

**Verify completion:**
```bash
# Check task status
node -e "const toml = require('@iarna/toml'); const fs = require('fs'); const data = toml.parse(fs.readFileSync('internal/sprints/ACTIVE_SPRINT_17.1_BUGS.toml', 'utf-8')); console.log('ENHANCE-001.2 status:', data.tasks['ENHANCE-001.2'].status);"
```

**Expected output:** `ENHANCE-001.2 status: completed`

---

## Key Reminders

### ‚ö†Ô∏è CRITICAL - Follow TDD Workflow:
1. **RED Phase:** Write tests FIRST (they MUST fail)
2. **GREEN Phase:** Implement MINIMUM code to pass tests
3. **REFACTOR Phase:** Optimize performance, clean up code

### ‚ö†Ô∏è CRITICAL - Architecture Validation:
This task validates the v3.0 architecture. If any builder doesn't work with the universal handler, the architecture needs adjustment (not the builder).

### ‚ö†Ô∏è CRITICAL - Error Handling:
All builders must gracefully handle:
- Git command failures (no git, empty repo)
- File search failures (no matches)
- Pattern library missing
- Ambiguous input

Never throw errors - always return valid EnhancementContext with warnings.

### ‚ö†Ô∏è CRITICAL - Performance:
Context building MUST be < 500ms. If slower:
- Limit git searches (--max-count)
- Cache results per session
- Parallelize searches when possible

---

## Success Criteria Checklist

Before marking complete, verify:

- [ ] All 3 builders implement IContextBuilder
- [ ] BugReportContextBuilder finds similar bugs
- [ ] FeatureRequestContextBuilder finds similar features
- [ ] GeneralContextBuilder extracts intent correctly
- [ ] All builders return valid EnhancementContext
- [ ] Integration with universal handler works
- [ ] All tests pass (90%+ coverage)
- [ ] Performance < 500ms for each builder
- [ ] TypeScript compiles with no errors
- [ ] Manual testing in Extension Host successful
- [ ] Sprint TOML completion notes added
- [ ] Changes committed with descriptive message

---

**END OF ENHANCED PROMPT**

Follow this prompt step-by-step, marking each step complete as you go. Use TodoWrite to track progress. Good luck! üöÄ
